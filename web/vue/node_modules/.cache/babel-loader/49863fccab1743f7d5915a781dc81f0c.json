{"remainingRequest":"/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue/node_modules/thread-loader/dist/cjs.js!/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue/node_modules/babel-loader/lib/index.js!/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue/src/d3/chart4.js","dependencies":[{"path":"/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue/src/d3/chart4.js","mtime":1569604667000},{"path":"/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue/node_modules/cache-loader/dist/cjs.js","mtime":1569708698000},{"path":"/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue/node_modules/thread-loader/dist/cjs.js","mtime":1569708698000},{"path":"/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue/node_modules/babel-loader/lib/index.js","mtime":1529635966000}],"contextDependencies":[],"result":["import _slicedToArray from \"/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue/node_modules/@babel/runtime/helpers/builtin/es6/slicedToArray\";\nimport _ from 'lodash'; // global moment\n\nexport default function (_data, _trades, _height) {\n  var toDate = function toDate(i) {\n    if (_.isNumber(i)) {\n      return moment.unix(i).utc().toDate();\n    } else {\n      return moment.utc(i).toDate();\n    }\n  };\n\n  var trades = _trades.map(function (t) {\n    return {\n      price: t.price,\n      date: toDate(t.date),\n      action: t.action\n    };\n  });\n\n  var data = _data.map(function (c) {\n    return {\n      price: c.open,\n      date: toDate(c.start)\n    };\n  });\n\n  var dates = data.map(function (c) {\n    return +c.date;\n  });\n  var prices = data.map(function (c) {\n    return +c.price;\n  });\n  var svg = d3.select(\"#chart\");\n  svg.attr(\"width\", window.innerWidth - 20);\n  var margin = {\n    top: 20,\n    right: 20,\n    bottom: 110,\n    left: 40\n  };\n  var height = _height - margin.top - margin.bottom;\n  var margin2 = {\n    top: _height - 70,\n    right: 20,\n    bottom: 30,\n    left: 40\n  };\n  var width = +svg.attr(\"width\") - margin.left - margin.right;\n  var height2 = _height - margin2.top - margin2.bottom;\n  var x = d3.scaleUtc().range([0, width]),\n      x2 = d3.scaleUtc().range([0, width]),\n      y = d3.scaleLinear().range([height, 0]),\n      y2 = d3.scaleLinear().range([height2, 0]);\n  var xAxis = d3.axisBottom(x),\n      xAxis2 = d3.axisBottom(x2),\n      yAxis = d3.axisLeft(y).ticks(_height / 50);\n  var brush = d3.brushX().extent([[0, 0], [width, height2]]).on(\"brush end\", brushed);\n  var zoom = d3.zoom().scaleExtent([1, 100]).translateExtent([[0, 0], [width, height]]).extent([[0, 0], [width, height]]).on(\"zoom\", zoomed);\n  var line = d3.line().x(function (d) {\n    return x(d.date);\n  }).y(function (d) {\n    return y(d.price);\n  });\n  var line2 = d3.line().x(function (d) {\n    return x2(d.date);\n  }).y(function (d) {\n    return y2(d.price);\n  });\n  svg.append(\"defs\").append(\"clipPath\").attr(\"id\", \"clip\").append(\"rect\").attr(\"width\", width).attr(\"height\", height);\n  var focus = svg.append(\"g\").attr(\"class\", \"focus\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n  var context = svg.append(\"g\").attr(\"class\", \"context\").attr(\"transform\", \"translate(\" + margin2.left + \",\" + margin2.top + \")\");\n  x.domain(d3.extent(data, function (d) {\n    return d.date;\n  }));\n  y.domain([d3.min(prices) * 0.99, d3.max(prices) * 1.01]);\n  x2.domain(x.domain());\n  y2.domain(y.domain());\n  focus.append(\"path\").datum(data).attr(\"class\", \"line price\").attr(\"d\", line);\n  focus.append(\"g\").attr(\"class\", \"axis axis--x\").attr(\"transform\", \"translate(0,\" + height + \")\").call(xAxis);\n  focus.append(\"g\").attr(\"class\", \"axis axis--y\").call(yAxis);\n  context.append(\"path\").datum(data).attr(\"class\", \"line\").attr(\"d\", line2);\n  context.append(\"g\").attr(\"class\", \"axis axis--x\").attr(\"transform\", \"translate(0,\" + height2 + \")\").call(xAxis2);\n  var circles = svg.append('g').attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\").selectAll(\"circle\").data(trades).enter().append(\"circle\").attr('class', function (d) {\n    return d.action;\n  }).attr(\"cx\", function (d) {\n    return x(d.date);\n  }).attr(\"cy\", function (d) {\n    return y(d.price);\n  }).attr('r', 5);\n  var brushCircles = context.append('g') // .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n  .selectAll(\"circle\").data(trades).enter().append(\"circle\").attr('class', function (d) {\n    return d.action;\n  }).attr(\"cx\", function (d) {\n    return x2(d.date);\n  }).attr(\"cy\", function (d) {\n    return y2(d.price);\n  }).attr('r', 3);\n  context.append(\"g\").attr(\"class\", \"brush\").call(brush).call(brush.move, x.range());\n  svg.append(\"rect\").attr(\"class\", \"zoom\").attr(\"width\", width).attr(\"height\", height).attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\").call(zoom);\n\n  function brushed() {\n    if (d3.event.sourceEvent && d3.event.sourceEvent.type === \"zoom\") return; // ignore brush-by-zoom\n\n    var s = d3.event.selection || x2.range();\n    x.domain(s.map(x2.invert, x2));\n    scaleY(x.domain());\n    svg.select(\".axis--y\").call(yAxis);\n    circles.attr(\"cx\", function (d) {\n      return x(d.date);\n    }).attr(\"cy\", function (d) {\n      return y(d.price);\n    });\n    focus.select(\".line\").attr(\"d\", line);\n    focus.select(\".axis--x\").call(xAxis);\n    svg.select(\".zoom\").call(zoom.transform, d3.zoomIdentity.scale(width / (s[1] - s[0])).translate(-s[0], 0));\n  }\n\n  function scaleY(domain) {\n    var _domain = _slicedToArray(domain, 2),\n        min = _domain[0],\n        max = _domain[1];\n\n    var minIndex = _.sortedIndex(dates, min);\n\n    var maxIndex = _.sortedIndex(dates, max);\n\n    var set = prices.slice(minIndex, maxIndex);\n    y.domain([d3.min(set) * 0.9995, d3.max(set) * 1.0005]);\n  }\n\n  function zoomed() {\n    if (d3.event.sourceEvent && d3.event.sourceEvent.type === \"brush\") return; // ignore zoom-by-brush\n\n    var t = d3.event.transform;\n    scaleY(t.rescaleX(x2).domain());\n    svg.select(\".axis--y\").call(yAxis);\n    x.domain(t.rescaleX(x2).domain());\n    focus.select(\".line\").attr(\"d\", line);\n    circles.attr(\"cx\", function (d) {\n      return x(d.date);\n    }).attr(\"cy\", function (d) {\n      return y(d.price);\n    });\n    focus.select(\".axis--x\").call(xAxis);\n    context.select(\".brush\").call(brush.move, x.range().map(t.invertX, t));\n  }\n}",{"version":3,"sources":["src/d3/chart4.js"],"names":["_","_data","_trades","_height","toDate","isNumber","i","moment","unix","utc","trades","map","price","t","date","action","data","c","open","start","dates","prices","svg","d3","select","attr","window","innerWidth","margin","top","right","bottom","left","height","margin2","width","height2","x","scaleUtc","range","x2","y","scaleLinear","y2","xAxis","axisBottom","xAxis2","yAxis","axisLeft","ticks","brush","brushX","extent","on","brushed","zoom","scaleExtent","translateExtent","zoomed","line","d","line2","append","focus","context","domain","min","max","datum","call","circles","selectAll","enter","brushCircles","move","event","sourceEvent","type","s","selection","invert","scaleY","transform","zoomIdentity","scale","translate","minIndex","sortedIndex","maxIndex","set","slice","rescaleX","invertX"],"mappings":"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","sourceRoot":"/Users/adr/Library/Mobile Documents/com~apple~CloudDocs/gekko/web/vue","sourcesContent":["import _ from 'lodash';\n// global moment\n\nexport default function(_data, _trades, _height) {\n\n  const toDate = i => {\n    if(_.isNumber(i)) {\n      return moment.unix(i).utc().toDate();\n    } else {\n      return moment.utc(i).toDate();\n    }\n  }\n\n  const trades = _trades.map(t => {\n    return {\n      price: t.price,\n      date: toDate(t.date),\n      action: t.action\n    }\n  });\n\n  const data = _data.map(c => {\n    return {\n      price: c.open,\n      date: toDate(c.start)\n    }\n  });\n\n  var dates = data.map(c => +c.date);\n  var prices = data.map(c => +c.price)\n\n  var svg = d3.select(\"#chart\");\n\n  svg.attr(\"width\", window.innerWidth - 20);\n\n  var margin = {top: 20, right: 20, bottom: 110, left: 40};\n  var height = _height - margin.top - margin.bottom;\n  var margin2 = {top: _height - 70, right: 20, bottom: 30, left: 40};\n  var width = +svg.attr(\"width\") - margin.left - margin.right;\n  var height2 = _height - margin2.top - margin2.bottom;\n\n  var x = d3.scaleUtc().range([0, width]),\n      x2 = d3.scaleUtc().range([0, width]),\n      y = d3.scaleLinear().range([height, 0]),\n      y2 = d3.scaleLinear().range([height2, 0]);\n\n  var xAxis = d3.axisBottom(x),\n      xAxis2 = d3.axisBottom(x2),\n      yAxis = d3.axisLeft(y).ticks(_height / 50);\n\n  var brush = d3.brushX()\n      .extent([[0, 0], [width, height2]])\n      .on(\"brush end\", brushed);\n\n  var zoom = d3.zoom()\n      .scaleExtent([1, 100])\n      .translateExtent([[0, 0], [width, height]])\n      .extent([[0, 0], [width, height]])\n      .on(\"zoom\", zoomed);\n\n  var line = d3.line()\n      .x(function(d) { return x(d.date); })\n      .y(function(d) { return y(d.price); });\n\n  var line2 = d3.line()\n      .x(function(d) { return x2(d.date); })\n      .y(function(d) { return y2(d.price); });\n\n  svg.append(\"defs\").append(\"clipPath\")\n      .attr(\"id\", \"clip\")\n    .append(\"rect\")\n      .attr(\"width\", width)\n      .attr(\"height\", height);\n\n  var focus = svg.append(\"g\")\n      .attr(\"class\", \"focus\")\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n  var context = svg.append(\"g\")\n      .attr(\"class\", \"context\")\n      .attr(\"transform\", \"translate(\" + margin2.left + \",\" + margin2.top + \")\");\n\n  x.domain(d3.extent(data, function(d) { return d.date; }));\n  y.domain([\n    d3.min(prices) * 0.99,\n    d3.max(prices) * 1.01\n  ]);\n  x2.domain(x.domain());\n  y2.domain(y.domain());\n\n  focus.append(\"path\")\n      .datum(data)\n      .attr(\"class\", \"line price\")\n      .attr(\"d\", line);\n\n  focus.append(\"g\")\n      .attr(\"class\", \"axis axis--x\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(xAxis);\n\n  focus.append(\"g\")\n      .attr(\"class\", \"axis axis--y\")\n      .call(yAxis);\n\n  context.append(\"path\")\n      .datum(data)\n      .attr(\"class\", \"line\")\n      .attr(\"d\", line2);\n\n  context.append(\"g\")\n      .attr(\"class\", \"axis axis--x\")\n      .attr(\"transform\", \"translate(0,\" + height2 + \")\")\n      .call(xAxis2);\n\n  var circles = svg\n    .append('g')\n    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n      .selectAll(\"circle\")\n      .data(trades)\n      .enter().append(\"circle\")\n        .attr('class', function(d) { return d.action })\n        .attr(\"cx\", function(d) { return x(d.date); })\n        .attr(\"cy\", function(d) { return y(d.price); })\n        .attr('r', 5);\n\n  var brushCircles = context\n    .append('g')\n    // .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n      .selectAll(\"circle\")\n      .data(trades)\n      .enter().append(\"circle\")\n        .attr('class', function(d) { return d.action })\n        .attr(\"cx\", function(d) { return x2(d.date); })\n        .attr(\"cy\", function(d) { return y2(d.price); })\n        .attr('r', 3);\n\n\n  context.append(\"g\")\n      .attr(\"class\", \"brush\")\n      .call(brush)\n      .call(brush.move, x.range());\n\n  svg.append(\"rect\")\n      .attr(\"class\", \"zoom\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n      .call(zoom);\n\n  function brushed() {\n    if (d3.event.sourceEvent && d3.event.sourceEvent.type === \"zoom\") return; // ignore brush-by-zoom\n    var s = d3.event.selection || x2.range();\n    x.domain(s.map(x2.invert, x2));\n\n    scaleY(x.domain());\n\n    svg.select(\".axis--y\")\n      .call(yAxis);\n\n    circles\n      .attr(\"cx\", function(d) { return x(d.date); })\n      .attr(\"cy\", function(d) { return y(d.price); })\n\n    focus.select(\".line\").attr(\"d\", line);\n    focus.select(\".axis--x\").call(xAxis);\n    svg.select(\".zoom\").call(zoom.transform, d3.zoomIdentity\n        .scale(width / (s[1] - s[0]))\n        .translate(-s[0], 0));\n  }\n\n  function scaleY(domain) {\n    let [min, max] = domain;\n\n    let minIndex = _.sortedIndex(dates, min);\n    let maxIndex = _.sortedIndex(dates, max);\n\n    let set = prices.slice(minIndex, maxIndex);\n    y.domain([\n      d3.min(set) * 0.9995,\n      d3.max(set) * 1.0005\n    ]);\n  }\n\n  function zoomed() {\n    if (d3.event.sourceEvent && d3.event.sourceEvent.type === \"brush\") return; // ignore zoom-by-brush\n    var t = d3.event.transform;\n\n    scaleY(t.rescaleX(x2).domain());    \n\n    svg.select(\".axis--y\")\n      .call(yAxis);\n\n    x.domain(t.rescaleX(x2).domain());\n    focus.select(\".line\").attr(\"d\", line);\n\n    circles\n      .attr(\"cx\", function(d) { return x(d.date); })\n      .attr(\"cy\", function(d) { return y(d.price); })\n\n\n    focus.select(\".axis--x\").call(xAxis);\n    context.select(\".brush\").call(brush.move, x.range().map(t.invertX, t));\n  }\n}"]}]}